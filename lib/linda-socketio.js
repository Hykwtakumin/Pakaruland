// Generated by CoffeeScript 1.6.3
var Linda, fs, http, socketio, url;

http = require('http');

url = require('url');

fs = require('fs');

socketio = require('socket.io');

Linda = (function() {
  function Linda() {
    var _this = this;
    fs.readFile(__dirname + "/linda-socketio-client.js", function(err, data) {
      if (err) {
        throw "client js load error";
      }
      return _this.client_js_code = data;
    });
  }

  Linda.prototype.listen = function(opts) {
    var _this = this;
    this.opts = opts != null ? opts : {
      io: null,
      server: null
    };
    if (!(this.opts.io instanceof socketio.Manager)) {
      throw '"io" must be instance of Socket.IO';
    }
    if (!(this.opts.server instanceof http.Server)) {
      throw '"server" must be instance of http.Server';
    }
    return this.opts.server.on('request', function(req, res) {
      var _url;
      _url = url.parse(decodeURI(req.url), true);
      if (_url.pathname === "/js/linda-socketio.js") {
        res.writeHead(200);
        return res.end(_this.client_js_code);
      }
    });
  };

  return Linda;

})();

module.exports = new Linda;
